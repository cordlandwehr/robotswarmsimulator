\documentclass[a4paper,halfparskip,11pt,twoside]{scrartcl}
\usepackage{schlaue_schwaerme}

\usepackage{url}

\newcommand{\R}{\mathbb{R}}
\newcommand{\cupdot}{\ensuremath{\mathaccent\cdot\cup}} % disjuncted union

\begin{document}
\init{}

\pgMaketitle{User's Guide}{
\begin{pgArrowitemize}
	\item Alexander Klaas
	\item Andreas Cord-Landwehr
	\item Christoph Raupach
	\item Christoph Weddemann
	\item Daniel Warner
	\item Daniel Wonisch
	\item Kamil Swierkot
	\item Marcus Märtens
	\item Martina Hüllmann
	\item Peter Kling
	\item Sven Kurras
\end{pgArrowitemize}
}

\section{Introduction}
This document shall help you to use the \RSS\ to simulate robot swarms and to get useful information by the visualization and statistics modules.

For this purpose the document is divided in several sections. It will be usefull if you just start with the ``Getting Started!'' section and play a little bit with the simulator and continue with reading the more detailed information on input parameters, input-file specifications, generating simulations and getting statistics.


\section{Getting Started}
For a first test of \RSS you can simply run it in generation mode, and use the generated scenario with one of our default algorithms. All example files can be found in subdirectory {\tt ProjectFiles} of the install directory. Here we will present a short example how to simulate the behavior of the {\sc CenterOfGravity} algorithm (COG).

\begin{enumerate}
	\item Change to the directory that contains the \RSS binary.
	\item Run the following command:

		\centerline{\tt RobotSwarmSimulator -{}-generate -{}-distr-pos 20 -{}-algorithm COGRobot}

		This will generate a simulation specification in form of the following files:
		\begin{itemize}
			\item {\tt newrandom.swarm} -- contains information about the simulation process
			\item {\tt newrandom.robot} -- contains information about the robots
			\item {\tt newrandom.obstacle} -- contains information about the obstacles
		\end{itemize}
		The last two files are referenced in the {\tt .swarm} file. Thus, to load the simulation, you only need to load the {\tt .swarm} file. Note that all these files
are simple text files that can be edited by hand.
	\item Run the command:

		\centerline{\tt RobotSwarmSimulator -{}-project-file newrandom -{}-output mylogs}

		This will start the simulation process. There are various keyboard shortcuts that can be used to control the simulation. Press \fbox{\tt h} for an overview. You can quit the simulation by pressing \fbox{\tt q}.
	\item The previous step will generate various output files in the subdirectory {\tt mylogs}, mainly produced by the statistics module of the \RSS. You may directly use Gnuplot to analyze these files.
\end{enumerate}
This simple example can be used as base for further test runs. Please look at the following chapters to get specifications of the input--files and the user's inferface.

\section{Running the \RSS\ with Parameters}
The \RSS\ exists as executable for Linux, Mac OS X and Windows. Each execution of the \RSS\ needs specific parameters that are mandatory. By running the \RSS\ you have to specify at least, which kind of execution you want. There are two main options:

\begin{itemize}
 \item By adding the parameter {\tt -{}-generate} the generation mode is started to create new input--files. This will generate three different files having the suffixes {\tt .swarm}, {\tt .robot} and {\tt .obstacle}. The most important of these is the {\tt .swarm} file, which references the other two files.
\item Using the parameter {\tt -{}-project-file $\langle$your\_input\_file$\rangle$}, the common simulation mode is started. In this case, <your input file> should be the name of a file having the suffix {\tt .swarm} (e.g. generated with generation mode).
\end{itemize}

There other command line options that may be used to show help or about messages and to customize the generation or simulation mode. Start the \RSS with the parameter {\tt -{}-help} to get an overview. A typical session may look like this:

\begin{verbatim}
    ./RobotSwarmSimulator --help
    ./RobotSwarmSimulator --project-file <path_to_testdata>/testfile_2 \\
                          --output <path_to_output_files> \\
                          --history-length 10
\end{verbatim}

All of the options listed in Listing~\ref{lst:RSS-help} can be used. Further information for this parameters can be found in the following sections. The definition of most of the parameters can be found in Table~\ref{tab:mainvars}.

\begin{lstlisting}[caption={RSS Helpline},label=lst:RSS-help]
localhost:~$ ./RobotSwarmSimulator --help

General options:
 --help                shows this help message
 --version             shows version of RobotSwarmSimulator
 --about               tells you who developed this awesome piece of software

Generator options:
 --generate                      switch to generator mode
 --seed arg (=1)                 seed for random number generator
 --robots arg (=100)             number of robots
 --algorithm arg (=NONE)         name of algorithm or lua-file
 --worldfile arg (=newrandom)    world-file for output
 --robotfile arg (=newrandom)    robot-file for output
 --obstaclefile arg (=newrandom) obstacle-file for output
 --add-pos-handler               add position request handler for testing
 --add-vel-handler               add velocity request handler for testing
 --add-acc-handler               add acceleration request handler for testing
 --distr-pos arg (=0)            distribute position in cube [0;distr-pos]^3
 --min-vel arg (=0)              distribute velocity in sphere with radius
                                 min-vel
 --max-vel arg (=0)              distribute velocity in sphere with max-vel
 --min-acc arg (=0)              distribute acceleration in sphere with radius
                                 min-acc
 --max-acc arg (=0)              distribute acceleration in sphere with radius
                                 max-acc
 --distr-coord                   distribute robot coordinate-systems uniformly

Simulation options:
 --project-file arg         Project file to load
 --output arg               Path to directory for output
 --history-length arg (=25) history length
\end{lstlisting}


\subsection{General options}
\begin{description}
	\item [-{}-help] Lists all possible options including a short description.
	\item [-{}-version] This option shows the version information of your \RSS.
	\item [-{}-about] Get information about the developer team, contact information and more.
\end{description}

\subsection{Generator options}
\begin{description}
	\item [-{}-generate] Switch to generator mode. This is necessary for the further options of this section.
	\item [-{}-seed arg] Sets the seed for the random number generator for robot generation. If not set the seed is {\tt 1}. An unsigned integer value is expected.
	\item [-{}-robots arg] The number of robots to be generated. The default number is 100. An unsigned integer value is expected.
	\item [-{}-algorithm arg] The name of the algorithm the robots should use. If not set the algorithm {\tt SimpleRobot} is used. This is only a stub without any functionality. Also the name of a lua-file can be given. Extensionsion {\tt .lua} is mandatory for lua-files.
	\item [-{}-worldfile arg] The name of the worldfile that shall be generated. Default is {\tt newrandom}. File-name without extension is expected.
	\item [-{}robotfile arg] The name of the robotfile that shall be generated. Default is {\tt newrandom}. File-name without extension is expected.
	\item [-{}-obstaclefile arg] The name of the obstaclefile that shall be generated. Default is {\tt newrandom}. File-name without extension is expected.
	\item [-{}-add-pos-handler] Causes the generated files to contain a position request handler with reasonable default values. If you need a more sophisticated position request handler, you have to edit the generated {\tt .swarm} file yourself.
	\item [-{}-add-vel-handler] Causes the generated files to contain a velocity request handler with reasonable default values. If you need a more sophisticated velocity request handler, you have to edit the generated {\tt .swarm} file yourself.
	\item [-{}-add-acc-handler] Causes the generated files to contain a acceleration request handler with reasonable default values. If you need a more acceleration request handler, you have to edit the generated {\tt .swarm} file yourself.
	\item [-{}-distr-pos arg] Distributes the position of robots uniformly at random in the cube $[-arg/2,+arg/2]^3$
 If not set, all robots are at position zero.
	\item [-{}-min-vel arg] The robots will be generated with a velocity distributed uniformly between the given minimum and maximum velocity (see {\tt -{}---max-vel}). This parameter defaults to 0.
	\item [-{}-max-vel arg] The robots will be generated with a velocity distributed uniformly between the given minimum and maximum velocity (see {\tt -{}---min-vel}). This parameter defaults to 0.
	\item [-{}-min-acc arg] The robots will be generated with a acceleration distributed uniformly between the given minimum and maximum velocity (see {\tt -{}-max-acc}). This parameter defaults to 0.
	\item [-{}-max-acc arg] The robots will be generated with a acceleration distributed uniformly between the given minimum and maximum velocity (see {\tt -{}-min-acc}). This parameter defaults to 0.
	\item [-{}-distr-coord arg] Generates uniformly distributed coordinate--systems for the robots. If this option is not given, all robots will have the same global coordinate system (defined by a unit matrix).
 If not set, all velocities are zero.
\end{description}

\subsection{Simulation options}
\begin{description}
	\item [-{}-project-file arg] Specifies the project file use. Use this parameter to load a simulation specified by a {\tt .swarm} file. Not that you may ommit the file extension {\tt .swarm}. Mandatory for simulation.
	\item [-{}-output arg] Specifies a directory to be used for files generated by the simulation (e.g. statistics files for Gnuplot). The given name is interpreted relative to the current directory and will create the directory if necessary. If ommitted, all generated files will be stored in the current directory.
	\item [-{}-history-length arg] Sets the history length i.e. the length of the ringbuffer that stores past simulation states. Standard is 25 (which should be a good choice in most cases). An unsigned integer is expected.
\end{description}


\section{Using the Simulator-Interface}
During the simulation it is possible to interact with the simulation in different ways. The following hot-keys are supported while simulation:

\begin{description}
	\item [\fbox{\tt Space}] Start/Stop
	\item [\fbox{\tt Q}] the Quit \RSS\
	\item [\fbox{\tt F1}] Help
	\item [\fbox{\tt G}] Show Center of all gravity of Swarm
	\item [\fbox{\tt V}] Show velocity vectors
	\item [\fbox{\tt B}] Show acceleration vectors
	\item [\fbox{\tt K}] Show global coordinates system
	\item [\fbox{\tt W},\fbox{\tt S}] In the corresponding camera mode use \fbox{\tt W} for up  and \fbox{\tt S} for down
	\item [Arrow-Keys] left, right, before, behind
	\item [Mouse] Mouse for spinning
	\item [\fbox{\tt +}, \fbox{\tt -}] increase/ decrease simulation-speed by constant
	\item [\fbox{\tt *},\fbox{\tt /}] double/ half simulation-speed
	\item [\fbox{\tt C}] Change camera
\end{description}

\section{Create Robot Algorithms for the \RSS}
There are two ways to define a new robot. One way is to write a subclass of \texttt{Robot} and add a new condition in the corresponding \texttt{factories.cc}. The other way is to define the robot algorithm by the {\sffamily Lua} scripting language and loading the algorithm at run-time. We want to stress, that a definition of robot algorithms by \Lua scripts only scales for small numbers of robots. I.\,e. for robot swarms of sizes greater than 500 robots you will (on standard computers) recognize a massive lack of performance.

\subsection{Create Robot Algorithms by Lua Scripts}
For information how to write \Lua scripts please visit \url{http://www.lua.org} and use the documentation presented there. For interacting the environment \Lua scripts may access the following functions and constants (if allowed by current VIEW and if according request handler are set):

\paragraph{\Lua Functions}
\begin{description}
	\item [\texttt{get\_visible\_robots()}] Returns array of robots.
	\item [\texttt{get\_visible\_obstacles()}] Returns array of obstacles.
	\item [\texttt{get\_visible\_markers()}] Returns array of markers.
	\item [\texttt{get\_position(<robot>)}] Returns Vector3d.
	\item [\texttt{get\_marker\_information(<robot>)}] Returns MarkerInformation.
	\item [\texttt{get\_id(<robot>)}] Returns integer.
	\item [\texttt{get\_robot\_acceleration(<robot>)}] Returns Vector3d.
	\item [\texttt{get\_robot\_coordinate\_system\_axis(<robot>)}] Returns CoordinateSystem.
	\item [\texttt{get\_robot\_type(<robot>)}] Returns RobotType.
	\item [\texttt{get\_robot\_status(<robot>)}] Returns RobotStatus.
	\item [\texttt{is\_point\_in\_obstacle(<obstacle>)}] Returns boolean.
	\item [\texttt{get\_box\_depth(<box>)}] Returns double.
	\item [\texttt{get\_box\_width(<box>)}] Returns double.
	\item [\texttt{get\_box\_height(<box>)}] Returns double.
	\item [\texttt{get\_sphere\_radius(<sphere>)}] Returns double.
	\item [\texttt{is\_box\_identifier(<identifier>)}] Returns boolean
	\item [\texttt{is\_sphere\_identifier(<identifier>)}] Returns boolean.
	\item [\texttt{add\_acceleration\_request(<Vector3d>)}]
	\item [\texttt{add\_position\_request(<Vector3d>)}]
	\item [\texttt{add\_velocity\_request(<Vector3d>)}]
	\item [\texttt{add\_marker\_request(<marker>)}]
	\item [\texttt{add\_type\_change\_request(<type>)}]
	\item [\texttt{get\_own\_identifier()}]
\end{description}

\paragraph{\Lua Constants}
\begin{description}
	\item [\texttt{RobotType}] \texttt{SLAVE, MASTER}
	\item [\texttt{RobotStatus}] \texttt{SLEEPING, READY}
\end{description}

\paragraph{Special Variable Types}
\begin{description}
	\item [\texttt{Vector3d}] This type is the \Lua equivalent to Vector3d in \RSS
	\begin{itemize}
		\item Operators: \texttt{+, *, /}
		\item Dimensions: \texttt{x, y, z}
	\end{itemize}
	\item [\texttt{MarkerInformation}] This is the data type for marker information. The information can be accessed by the according operators:
	\begin{itemize}
		\item Operators: \texttt{add\_data, get\_data}
	\end{itemize}
	\item [\texttt{CoordinateSystem}] This type consists of the Vector3d objects. The axes can be accessed by the following methods:
	\begin{itemize}
		\item Operators: \texttt{x\_axis, y\_axis, z\_axis}
	\end{itemize}

\end{description}

\subsubsection{Example Algorithm}
For example Listing~\ref{lst:cog-lua} shows you how to formulate the COG-algorithm in Lua.

\lstset{language=c}
\begin{lstlisting}[caption={COG algorithm in Lua},label=lst:cog-lua]
function main() 
    robots = get_visible_robots();
    center = get_position(get_own_identifier());
    for i = 1, #robots do
        center = center + get_position(robots[i]);
    end
    center = center / (#robots+1);
    add_position_request(center);
end
\end{lstlisting}

\subsection{Create Robot Algorithms by C++}
By creating a new robot algorithm inside the simulator you need to do the following steps:
\begin{enumerate}
	\item Create a subclass of \texttt{Robot}.
	\item Put the algorithm into \texttt{src/RobotImplementations/}.
	\item Write the method \texttt{compute()}.
	\item Write the method \texttt{get\_algorithm\_id()}.
	\item Add the algorithm identifier as option in file \texttt{src/SimulationKernel/factories.cc} in method \texttt{robot\_factory(\dots)}.
\end{enumerate}



\section{Statistics}
A simulation run results in three output files of statistics:

\begin{itemize}
\item \texttt{gnuplot\_20091224\_184129\_ALL.plt} (GNUPlot-configuration file)
\item \texttt{output\_20091224\_184129\_ALL.plt} (according statistic data)
\item \texttt{output\_20091224\_184129\_DATADUMP\_FULL.plt} (complete data dump)
\end{itemize}

The file-names results from current date (year, month, day), the current time (hour, minute, second), followed by description of screened object subset (e.\.g. \texttt{ALL, MASTERS,}\dots). For each entry in STATISTICS\_SUBSETS there will be created one such data pair.

\newpage
\appendix
\input{gnuplot}

\newpage
\input{inputfile_specification}

% Backcover
\newpage
\thispagestyle{empty}
~
\end{document}
